<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Abysm</title>
    <style>
        :root {
            --bg: #000;
            --fg: #fff;
            --accent: #aaa;
            --hit: #ddd;
            --special: #f55;
            --timer-warn: #f90;
            --timer-danger: #f00;
            --achieve: #0f0;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: monospace;
            background: var(--bg);
            color: var(--fg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            touch-action: manipulation;
            overflow: hidden;
        }
        #game {
            width: 100%;
            max-width: 480px;
            padding: 1.5rem;
            background: #111;
            border: 2px solid var(--fg);
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
            text-shadow: 0 0 5px var(--fg);
        }
        #level {
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 0.3rem;
        }
        #score {
            font-size: 1.2rem;
            margin: 0.5rem 0;
            font-weight: bold;
        }
        #timer {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 0.5rem 0;
            min-height: 1.5em;
            transition: color 0.3s ease;
        }
        #sequence {
            font-size: 1.5rem;
            margin: 1rem 0;
            letter-spacing: 0.4em;
            font-weight: bold;
            min-height: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.3em;
            perspective: 1000px;
        }
        .seq-digit {
            display: inline-block;
            opacity: 0;
            transform: translateY(-15px) rotateX(-30deg);
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .seq-digit.show {
            opacity: 1;
            transform: translateY(0) rotateX(0);
        }
        .seq-digit.active {
            color: var(--hit);
            transform: scale(1.4) translateY(-5px);
            text-shadow: 0 0 10px var(--hit);
            transition: all 0.15s ease;
        }
        #boss-container {
            position: relative;
            height: 160px;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #boss {
            width: 100px;
            height: 100px;
            background: var(--fg);
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
            transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 0 5px var(--fg));
        }
        #boss.special {
            background: var(--special);
            filter: drop-shadow(0 0 15px var(--special));
            animation: specialGlow 1.5s infinite alternate;
        }
        @keyframes specialGlow {
            from { filter: drop-shadow(0 0 10px var(--special)); }
            to { filter: drop-shadow(0 0 25px var(--special)); }
        }
        #boss.hit {
            background: var(--hit);
            transform: scale(1.3) rotate(8deg);
            filter: drop-shadow(0 0 20px var(--hit));
            animation: hitPulse 0.35s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        @keyframes hitPulse {
            0%, 100% { transform: scale(1.3) rotate(8deg); }
            50% { transform: scale(1.5) rotate(-8deg); }
        }
        #boss.dead {
            background: var(--bg);
            transform: scale(0) rotate(720deg);
            filter: none;
            transition: all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: var(--fg);
            border-radius: 50%;
            pointer-events: none;
            animation: particleBurst 0.7s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }
        .particle.special {
            background: var(--special);
        }
        @keyframes particleBurst {
            to {
                transform: translate(var(--dx), var(--dy)) scale(0);
                opacity: 0;
            }
        }
        #controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }
        .key {
            width: 60px;
            height: 60px;
            background: var(--fg);
            color: var(--bg);
            border: none;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.2, 0.8, 0.2, 1);
            user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .key:active,
        .key.pressed {
            background: var(--accent);
            transform: scale(0.85) translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        #info {
            margin: 1rem 0;
            font-size: 0.9rem;
            color: #888;
        }
        button {
            background: var(--fg);
            color: var(--bg);
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        button:hover {
            background: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        #achievements {
            position: fixed;
            top: 1rem;
            right: 1rem;
            max-width: 200px;
            background: rgba(17,17,17,0.9);
            border: 1px solid var(--fg);
            padding: 0.5rem;
            font-size: 0.8rem;
            color: var(--achieve);
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 10;
        }
        #achievements.show {
            opacity: 1;
        }
        footer {
            margin-top: 1rem;
            font-size: 0.8rem;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        footer:hover {
            opacity: 0.8;
        }
        footer a {
            color: inherit;
            text-decoration: none;
        }
        @media (max-width: 480px) {
            h1 { font-size: 1.5rem; }
            #sequence { font-size: 1.3rem; letter-spacing: 0.3em; }
            .key { width: 50px; height: 50px; font-size: 1.3rem; }
            #boss { width: 80px; height: 80px; }
            #timer { font-size: 1.1rem; }
            #achievements { max-width: 150px; font-size: 0.7rem; top: 0.5rem; right: 0.5rem; }
        }
    </style>
</head>
<body>
    <div id="game">
        <h1>PROJECT ABYSM</h1>
        <div id="level">LEVEL 1</div>
        <div id="score">SCORE: 0</div>
        <div id="timer"></div>
        <div id="sequence"></div>
        <div id="boss-container">
            <div id="boss"></div>
        </div>
        <div id="controls">
            <button class="key" data-key="1">1</button>
            <button class="key" data-key="2">2</button>
            <button class="key" data-key="3">3</button>
        </div>
        <div id="info">TAP KEYS OR PRESS 1·2·3</div>
        <button id="start-btn">START</button>
    </div>
    <div id="achievements"></div>
    <footer>
        <a href="https://github.com/unharne" target="_blank">powered by unharne</a>
    </footer>

    <script>
        const seqDisplay = document.getElementById('sequence');
        const boss = document.getElementById('boss');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const timerEl = document.getElementById('timer');
        const startBtn = document.getElementById('start-btn');
        const keys = document.querySelectorAll('.key');
        const achievementsEl = document.getElementById('achievements');

        let sequence = [];
        let playerSeq = [];
        let score = 0;
        let level = 0;
        let bossHealth = 0;
        let playing = false;
        let seqElements = [];
        let isSpecial = false;
        let timer = 0;
        let timerInterval = null;
        let streak = 0;
        let highestLevel = 0;
        let specialDefeated = 0;

        const specialBosses = [5, 10, 15, 25, 35, 50];

        const achievements = [
            { id: 'first', name: 'First Blood', desc: 'Defeat level 1', unlocked: false },
            { id: 'streak5', name: 'On Fire', desc: '5 perfect inputs in a row', unlocked: false },
            { id: 'level10', name: 'Abyssal Warrior', desc: 'Reach level 10', unlocked: false },
            { id: 'special1', name: 'Elite Slayer', desc: 'Defeat a special boss', unlocked: false },
            { id: 'perfect', name: 'Flawless', desc: 'Complete a boss without mistakes', unlocked: false },
            { id: 'speed', name: 'Lightning Fast', desc: 'Defeat boss in under 5s', unlocked: false }
        ];

        function loadAchievements() {
            const saved = localStorage.getItem('abysm_achievements');
            if (saved) {
                const unlocked = JSON.parse(saved);
                achievements.forEach(a => {
                    if (unlocked.includes(a.id)) a.unlocked = true;
                });
            }
        }

        function saveAchievements() {
            const unlocked = achievements.filter(a => a.unlocked).map(a => a.id);
            localStorage.setItem('abysm_achievements', JSON.stringify(unlocked));
        }

        function unlockAchievement(id) {
            const ach = achievements.find(a => a.id === id);
            if (ach && !ach.unlocked) {
                ach.unlocked = true;
                showAchievement(ach);
                saveAchievements();
            }
        }

        function showAchievement(ach) {
            achievementsEl.textContent = `ACHIEVEMENT: ${ach.name} - ${ach.desc}`;
            achievementsEl.classList.add('show');
            setTimeout(() => achievementsEl.classList.remove('show'), 3000);
        }

        function start() {
            score = 0;
            level = 0;
            streak = 0;
            scoreEl.textContent = 'SCORE: 0';
            levelEl.textContent = 'LEVEL 1';
            timerEl.textContent = '';
            boss.className = '';
            seqDisplay.innerHTML = '';
            playing = true;
            loadAchievements();
            nextLevel();
        }

        function nextLevel() {
            level++;
            if (level > highestLevel) {
                highestLevel = level;
                if (level === 10) unlockAchievement('level10');
            }
            levelEl.textContent = `LEVEL ${level}`;
            isSpecial = specialBosses.includes(level);
            if (isSpecial) boss.classList.add('special');
            bossHealth = isSpecial ? level * 8 : level * 5;
            const len = Math.min(5 + Math.floor(level / 2), 20);
            sequence = generateSequence(len);
            playerSeq = [];
            displaySequence();
            updateBoss();
            startTimer();
            if (level === 1) unlockAchievement('first');
        }

        function generateSequence(len) {
            const seq = [];
            for (let i = 0; i < len; i++) {
                seq.push(Math.floor(Math.random() * 3) + 1);
            }
            return seq;
        }

        function displaySequence() {
            seqDisplay.innerHTML = '';
            seqElements = [];
            sequence.forEach((num, i) => {
                const span = document.createElement('span');
                span.textContent = num;
                span.className = 'seq-digit';
                seqDisplay.appendChild(span);
                seqElements.push(span);
                setTimeout(() => span.classList.add('show'), i * 60);
            });
        }

        function startTimer() {
            clearInterval(timerInterval);
            const baseTime = 20;
            const timePerDigit = 1.2;
            timer = Math.max(baseTime - level * 0.5, 8) + sequence.length * timePerDigit;
            if (isSpecial) timer *= 1.3;
            updateTimerDisplay();
            const startTime = Date.now();
            timerInterval = setInterval(() => {
                timer -= 0.1;
                updateTimerDisplay();
                if (timer <= 0) {
                    gameOver();
                }
            }, 100);
            return startTime;
        }

        function updateTimerDisplay() {
            const secs = Math.max(0, Math.ceil(timer));
            timerEl.textContent = `TIME: ${secs}s`;
            if (secs <= 5) {
                timerEl.style.color = 'var(--timer-danger)';
            } else if (secs <= 10) {
                timerEl.style.color = 'var(--timer-warn)';
            } else {
                timerEl.style.color = 'var(--fg)';
            }
        }

        function press(num) {
            if (!playing) return;
            playerSeq.push(num);
            streak++;
            if (streak === 5) unlockAchievement('streak5');
            triggerKeyPress(num);
            highlightCurrent();
            checkProgress();
        }

        function highlightCurrent() {
            const idx = playerSeq.length - 1;
            if (seqElements[idx]) {
                seqElements[idx].classList.add('active');
                setTimeout(() => seqElements[idx].classList.remove('active'), 200);
            }
        }

        function triggerKeyPress(num) {
            const key = document.querySelector(`.key[data-key="${num}"]`);
            if (key) {
                key.classList.add('pressed');
                setTimeout(() => key.classList.remove('pressed'), 150);
            }
            createParticles(key || boss, false);
        }

        function createParticles(el, special = false) {
            const rect = el.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const count = special ? 15 : 6;
            const colorClass = special ? 'special' : '';
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = `particle ${colorClass}`;
                const angle = (i * 360 / count) * Math.PI / 180 + Math.random() * 0.5;
                const dist = 25 + Math.random() * 30;
                p.style.setProperty('--dx', `${Math.cos(angle) * dist}px`);
                p.style.setProperty('--dy', `${Math.sin(angle) * dist}px`);
                p.style.left = `${centerX}px`;
                p.style.top = `${centerY}px`;
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 700);
            }
        }

        function checkProgress() {
            const idx = playerSeq.length - 1;
            if (playerSeq[idx] !== sequence[idx]) {
                streak = 0;
                gameOver();
                return;
            }
            if (playerSeq.length === sequence.length) {
                hitBoss();
            }
        }

        function hitBoss() {
            const levelStartTime = performance.now();
            bossHealth -= sequence.length;
            boss.classList.add('hit');
            setTimeout(() => boss.classList.remove('hit'), 350);
            createParticles(boss, isSpecial);
            updateBoss();
            if (bossHealth <= 0) {
                clearInterval(timerInterval);
                const elapsed = (performance.now() - levelStartTime) / 1000;
                if (elapsed < 5) unlockAchievement('speed');
                if (playerSeq.length === sequence.length && streak >= sequence.length) {
                    unlockAchievement('perfect');
                }
                const points = isSpecial ? level * 25 : level * 10;
                score += points;
                scoreEl.textContent = `SCORE: ${score}`;
                if (isSpecial) {
                    specialDefeated++;
                    unlockAchievement('special1');
                }
                setTimeout(() => {
                    boss.classList.add('dead');
                    setTimeout(() => {
                        boss.classList.remove('special', 'dead');
                        nextLevel();
                    }, 600);
                }, 350);
            } else {
                playerSeq = [];
                displaySequence();
            }
        }

        function updateBoss() {
            const maxHealth = isSpecial ? level * 8 : level * 5;
            const scale = bossHealth > 0 ? bossHealth / maxHealth : 0;
            boss.style.transform = `scale(${scale})`;
        }

        function gameOver() {
            playing = false;
            streak = 0;
            clearInterval(timerInterval);
            createParticles(boss, false);
            setTimeout(() => {
                alert(`TIME'S UP!\nSCORE: ${score}`);
                boss.className = '';
                start();
            }, 300);
        }

        keys.forEach(key => {
            key.addEventListener('touchstart', e => {
                e.preventDefault();
                press(parseInt(key.dataset.key));
            });
            key.addEventListener('mousedown', e => {
                e.preventDefault();
                press(parseInt(key.dataset.key));
            });
        });

        document.addEventListener('keydown', e => {
            if (!playing) return;
            const k = e.key;
            if (k === '1' || k === '2' || k === '3') {
                e.preventDefault();
                press(parseInt(k));
            }
        });

        startBtn.addEventListener('click', start);

        // Init
        loadAchievements();
    </script>
</body>

</html>
