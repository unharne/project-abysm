<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>project abysm</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M50 0 L100 38 L82 100 L18 100 L0 38 Z' fill='%23fff'/></svg>" type="image/svg+xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600&display=swap');

        :root {
            --bg: #000;
            --fg: #fff;
            --accent: #aaa;
            --hit: #ccc;
            --special: #bbb;
            --timer-warn: #aaa;
            --timer-danger: #999;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'SF Pro Display', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--fg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            touch-action: manipulation;
            overflow: hidden;
        }
        #game {
            width: 100%;
            max-width: 480px;
            padding: 2rem 1.5rem;
            background: rgba(10,10,10,0.95);
            border-radius: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
        }
        #stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--accent);
            margin: 0.4rem 0;
        }
        #timer {
            font-size: 1.15rem;
            font-weight: 500;
            margin: 0.6rem 0;
            transition: color 0.4s ease;
        }
        #sequence {
            font-size: 1.6rem;
            font-weight: 600;
            margin: 1.2rem 0;
            letter-spacing: 0.3em;
            min-height: 2.2em;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.25em;
        }
        .seq-digit {
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .seq-digit.show {
            opacity: 1;
            transform: scale(1);
        }
        .seq-digit.active {
            color: var(--hit);
            transform: scale(1.12);
            transition: all 0.2s ease;
        }
        .seq-digit.done {
            color: var(--hit);
            opacity: 0.7;
        }
        #boss-container {
            height: 160px;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #boss {
            width: 100px;
            height: 100px;
            background: var(--fg);
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), background 0.4s ease, opacity 0.4s ease;
        }
        #boss.special {
            background: var(--special);
            animation: specialPulse 2s infinite ease-in-out;
        }
        @keyframes specialPulse {
            0%, 100% { opacity: 0.88; }
            50% { opacity: 1; }
        }
        #boss.hit {
            background: var(--hit);
            transform: scale(1.1);
        }
        #boss.dead {
            transform: scale(0) rotate(360deg);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--fg);
            border-radius: 50%;
            pointer-events: none;
            animation: particleBurst 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }
        .particle.special {
            background: var(--special);
        }
        @keyframes particleBurst {
            to {
                transform: translate(var(--dx), var(--dy)) scale(0);
                opacity: 0;
            }
        }
        #controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }
        .key {
            width: 64px;
            height: 64px;
            background: rgba(255,255,255,0.1);
            color: var(--fg);
            border: none;
            font-size: 1.6rem;
            font-weight: 600;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.15s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .key:active,
        .key.pressed {
            background: rgba(255,255,255,0.25);
            transform: scale(0.92);
        }
        #info {
            font-size: 0.85rem;
            color: var(--accent);
            margin-bottom: 0.6rem;
            font-weight: 500;
        }
        #toggle-btn {
            background: rgba(255,255,255,0.15);
            color: var(--fg);
            border: none;
            padding: 0.8rem 1.6rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            margin-top: 0.5rem;
        }
        #toggle-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        #modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20;
            backdrop-filter: blur(8px);
        }
        #modal-content {
            background: rgba(10,10,10,0.95);
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 80%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        #modal-content h2 {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        #restart-btn {
            background: rgba(255,255,255,0.15);
            color: var(--fg);
            border: none;
            padding: 0.7rem 1.4rem;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 1rem;
            transition: background 0.2s ease;
        }
        #restart-btn:hover {
            background: rgba(255,255,255,0.25);
        }
        footer {
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--accent);
            opacity: 0.6;
        }
        footer a {
            color: inherit;
            text-decoration: none;
        }
        @media (max-width: 480px) {
            h1 { font-size: 1.6rem; }
            #sequence { font-size: 1.4rem; letter-spacing: 0.25em; }
            .key { width: 56px; height: 56px; font-size: 1.4rem; }
            #boss { width: 80px; height: 80px; }
            #timer { font-size: 1.1rem; }
            #game { padding: 1.5rem 1rem; border-radius: 16px; }
        }
    </style>
</head>
<body>
    <div id="game">
        <h1>project abysm</h1>
        <div id="stats">
            <div id="level">LEVEL 1</div>
            <div id="score">SCORE: 0</div>
            <div id="high-score">HIGH: 0</div>
        </div>
        <div id="timer"></div>
        <div id="sequence"></div>
        <div id="boss-container">
            <div id="boss"></div>
        </div>
        <div id="controls">
            <button class="key" data-key="1">1</button>
            <button class="key" data-key="2">2</button>
            <button class="key" data-key="3">3</button>
        </div>
        <div id="info">TAP OR PRESS 1·2·3</div>
        <button id="toggle-btn">START</button>
    </div>
    <div id="modal">
        <div id="modal-content">
            <h2>END</h2>
            <p id="final-score"></p>
            <button id="restart-btn">RETRY</button>
        </div>
    </div>
    <footer>
        <p>© 2025 project abysm<p/>
        <a href="https://github.com/unharne" target="_blank">developed by unharne</a>
    </footer>

    <script>
        const elements = {
            seqDisplay: document.getElementById('sequence'),
            boss: document.getElementById('boss'),
            scoreEl: document.getElementById('score'),
            highScoreEl: document.getElementById('high-score'),
            levelEl: document.getElementById('level'),
            timerEl: document.getElementById('timer'),
            toggleBtn: document.getElementById('toggle-btn'),
            restartBtn: document.getElementById('restart-btn'),
            modal: document.getElementById('modal'),
            finalScoreEl: document.getElementById('final-score'),
            keys: document.querySelectorAll('.key')
        };

        let state = {
            sequence: [],
            playerSeq: [],
            score: 0,
            highScore: localStorage.getItem('abysm_highscore') || 0,
            level: 0,
            bossHealth: 0,
            playing: false,
            paused: false,
            seqElements: [],
            isSpecial: false,
            timer: 0,
            timerInterval: null,
            streak: 0,
            levelStartTime: 0
        };

        const config = {
            specialBosses: [5, 10, 15, 20, 25, 30, 35, 40, 45, 50],
            maxLevel: 50
        };

        function loadHighScore() {
            elements.highScoreEl.textContent = `HIGH: ${state.highScore}`;
        }

        function saveHighScore() {
            if (state.score > state.highScore) {
                state.highScore = state.score;
                localStorage.setItem('abysm_highscore', state.highScore);
                elements.highScoreEl.textContent = `HIGH: ${state.highScore}`;
            }
        }

        function initGame() {
            state.score = 0;
            state.level = 0;
            state.streak = 0;
            elements.scoreEl.textContent = 'SCORE: 0';
            elements.levelEl.textContent = 'LEVEL 1';
            elements.timerEl.textContent = '';
            elements.boss.className = '';
            elements.seqDisplay.innerHTML = '';
            state.playing = true;
            state.paused = false;
            elements.toggleBtn.textContent = 'STOP';
            elements.modal.style.display = 'none';
            loadHighScore();
            nextLevel();
        }

        function toggleGame() {
            if (!state.playing) {
                initGame();
            } else {
                state.paused = !state.paused;
                elements.toggleBtn.textContent = state.paused ? 'RESUME' : 'STOP';
                if (state.paused) {
                    clearInterval(state.timerInterval);
                } else {
                    startTimer();
                }
            }
        }

        function nextLevel() {
            if (state.paused) return;
            state.level++;
            elements.levelEl.textContent = `LEVEL ${state.level}`;
            state.isSpecial = config.specialBosses.includes(state.level);
            if (state.isSpecial) elements.boss.classList.add('special');
            state.bossHealth = state.isSpecial ? state.level * 12 : state.level * 7;
            const len = Math.min(4 + Math.floor(state.level / 3), 30);
            state.sequence = generateSequence(len);
            state.playerSeq = [];
            displaySequence();
            updateBoss();
            state.levelStartTime = performance.now();
            startTimer();
        }

        function generateSequence(len) {
            const seq = [];
            for (let i = 0; i < len; i++) seq.push(Math.floor(Math.random() * 3) + 1);
            return seq;
        }

        function displaySequence() {
            elements.seqDisplay.innerHTML = '';
            state.seqElements = [];
            state.sequence.forEach((num, i) => {
                const span = document.createElement('span');
                span.textContent = num;
                span.className = 'seq-digit';
                elements.seqDisplay.appendChild(span);
                state.seqElements.push(span);
                setTimeout(() => span.classList.add('show'), i * 40);
            });
        }

        function startTimer() {
            clearInterval(state.timerInterval);
            const baseTime = 14 - Math.floor(state.level / 8);
            const timePerDigit = 0.7 + (state.level / 40);
            state.timer = Math.max(baseTime, 5) + state.sequence.length * timePerDigit;
            if (state.isSpecial) state.timer *= 1.15;
            updateTimerDisplay();
            state.timerInterval = setInterval(() => {
                state.timer -= 0.1;
                updateTimerDisplay();
                if (state.timer <= 0) gameOver();
            }, 100);
        }

        function updateTimerDisplay() {
            const secs = Math.max(0, Math.ceil(state.timer));
            elements.timerEl.textContent = `TIME: ${secs}`;
            if (secs <= 5) elements.timerEl.style.color = 'var(--timer-danger)';
            else if (secs <= 10) elements.timerEl.style.color = 'var(--timer-warn)';
            else elements.timerEl.style.color = 'var(--fg)';
        }

        function press(num) {
            if (!state.playing || state.paused) return;
            state.playerSeq.push(num);
            if (state.playerSeq[state.playerSeq.length - 1] !== state.sequence[state.playerSeq.length - 1]) {
                gameOver();
                return;
            }
            state.streak++;
            triggerKeyPress(num);
            highlightCurrent();
            if (state.playerSeq.length === state.sequence.length) hitBoss();
        }

        function highlightCurrent() {
            const idx = state.playerSeq.length - 1;
            if (state.seqElements[idx]) {
                state.seqElements[idx].classList.add('active');
                setTimeout(() => state.seqElements[idx].classList.remove('active'), 200);
            }
            state.seqElements.forEach((el, i) => {
                if (i < state.playerSeq.length) el.classList.add('done');
                else el.classList.remove('done');
            });
        }

        function triggerKeyPress(num) {
            const key = document.querySelector(`.key[data-key="${num}"]`);
            if (key) {
                key.classList.add('pressed');
                setTimeout(() => key.classList.remove('pressed'), 150);
            }
            createParticles(key || elements.boss, false);
        }

        function createParticles(el, special = false) {
            const rect = el.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const count = special ? 12 : 6;
            const colorClass = special ? 'special' : '';
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = `particle ${colorClass}`;
                const angle = (i * 360 / count) * Math.PI / 180;
                const dist = 20 + Math.random() * 20;
                p.style.setProperty('--dx', `${Math.cos(angle) * dist}px`);
                p.style.setProperty('--dy', `${Math.sin(angle) * dist}px`);
                p.style.left = `${centerX}px`;
                p.style.top = `${centerY}px`;
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        }

        function hitBoss() {
            state.bossHealth -= Math.floor(state.sequence.length * (1 + state.streak / 10));
            elements.boss.classList.add('hit');
            setTimeout(() => elements.boss.classList.remove('hit'), 350);
            createParticles(elements.boss, state.isSpecial);
            updateBoss();
            if (state.bossHealth <= 0) {
                clearInterval(state.timerInterval);
                const points = state.isSpecial ? state.level * 35 : state.level * 20;
                state.score += points;
                elements.scoreEl.textContent = `SCORE: ${state.score}`;
                saveHighScore();
                setTimeout(() => {
                    elements.boss.classList.add('dead');
                    setTimeout(() => {
                        elements.boss.classList.remove('special', 'dead', 'hit');
                        elements.boss.style.transform = 'scale(1)';
                        elements.boss.style.opacity = '1';
                        if (state.level >= config.maxLevel) gameWin();
                        else nextLevel();
                    }, 600);
                }, 350);
            } else {
                state.playerSeq = [];
                displaySequence();
            }
        }

        function updateBoss() {
            const maxHealth = state.isSpecial ? state.level * 12 : state.level * 7;
            const scale = state.bossHealth > 0 ? state.bossHealth / maxHealth : 0;
            elements.boss.style.transform = `scale(${scale})`;
        }

        function gameOver() {
            state.playing = false;
            state.paused = false;
            clearInterval(state.timerInterval);
            createParticles(elements.boss, false);
            elements.finalScoreEl.textContent = `SCORE: ${state.score}`;
            elements.modal.style.display = 'flex';
            elements.toggleBtn.textContent = 'START';
        }

        function gameWin() {
            elements.finalScoreEl.textContent = `WIN! SCORE: ${state.score}`;
            elements.modal.style.display = 'flex';
            elements.toggleBtn.textContent = 'START';
        }

        elements.keys.forEach(key => {
            key.addEventListener('touchstart', e => { e.preventDefault(); press(parseInt(key.dataset.key)); });
            key.addEventListener('mousedown', e => { e.preventDefault(); press(parseInt(key.dataset.key)); });
        });

        document.addEventListener('keydown', e => {
            if (!state.playing || state.paused) return;
            const k = e.key;
            if (['1', '2', '3'].includes(k)) { e.preventDefault(); press(parseInt(k)); }
        });

        elements.toggleBtn.addEventListener('click', toggleGame);
        elements.restartBtn.addEventListener('click', initGame);

        loadHighScore();
    </script>
</body>
</html>
